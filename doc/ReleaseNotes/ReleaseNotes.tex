\documentclass[11pt,twoside,twocolumn]{usgsreport}
\usepackage{usgsfonts}
\usepackage{usgsgeo}
\usepackage{usgsidx}
\usepackage[tabletoc]{usgsreporta}

\usepackage{amsmath}
\usepackage{algorithm}
\usepackage{algpseudocode}
\usepackage{bm}
\usepackage{calc}
\usepackage{natbib}
\usepackage{bibentry}
\usepackage{graphicx}
\usepackage{longtable}

\usepackage[T1]{fontenc}

\makeindex
\usepackage{setspace}
% uncomment to make double space 
%\doublespacing
\usepackage{etoolbox}
%\usepackage{verbatim}

\usepackage{titlesec}


\usepackage[hidelinks]{hyperref}
\hypersetup{
    pdftitle={MODFLOW~6 Release Notes},
    pdfauthor={MODFLOW~6 Development Team},
    pdfsubject={MODFLOW~6 Release Notes},
    pdfkeywords={MODFLOW, groundwater model, simulation},
    bookmarksnumbered=true,     
    bookmarksopen=true,         
    bookmarksopenlevel=1,       
    colorlinks=true,
    allcolors={blue},          
    pdfstartview=Fit,           
    pdfpagemode=UseOutlines,
    pdfpagelayout=TwoPageRight
}


\graphicspath{{./Figures/}}
\input{../version.tex}


\renewcommand{\cooperator}
{the \textusgs\ Water Availability and Use Science Program}
\renewcommand{\reporttitle}
{MODFLOW~6 Release Notes}
\renewcommand{\coverphoto}{coverimage.jpg}
\renewcommand{\GSphotocredit}{Binary computer code illustration.}
\renewcommand{\reportseries}{}
\renewcommand{\reportnumber}{}
\renewcommand{\reportyear}{2017}
\ifdef{\reportversion}{\renewcommand{\reportversion}{\currentmodflowversion}}{}
\renewcommand{\theauthors}{MODFLOW~6 Development Team}
\renewcommand{\thetitlepageauthors}{\theauthors}
%\renewcommand{\theauthorslastfirst}{}
\renewcommand{\reportcitingtheauthors}{MODFLOW~6 Development Team}
\renewcommand{\colophonmoreinfo}{}
\renewcommand{\theoffice}{Office of Groundwater \\ U.S. Geological Survey \\ Mail Stop 411 \\ 12201 Sunrise Valley Drive \\ Reston, VA 20192 \\ (703) 648-5001}
\renewcommand{\reportbodypages}{}
\urlstyle{rm}
\renewcommand{\reportwebsiteroot}{https://doi.org/10.5066/}
\renewcommand{\reportwebsiteremainder}{F76Q1VQV}
%\renewcommand{\doisecretary}{RYAN K. ZINKE}
%\renewcommand{\usgsdirector}{William H. Werkheiser}
%\ifdef{\usgsdirectortitle}{\renewcommand{\usgsdirectortitle}{Acting Director}}{}
\ifdef{\usgsissn}{\renewcommand{\usgsissn}{}}{}
\renewcommand{\theconventions}{}
\definecolor{coverbar}{RGB}{32, 18, 88}
\renewcommand{\bannercolor}{\color{coverbar}}
%\renewcommand{\thePSC}{the MODFLOW~6 Development Team}
%\renewcommand{\theeditor}{Christian D. Langevin}
%\renewcommand{\theillustrator}{None}
%\renewcommand{\thefirsttypesetter}{Joseph D. Hughes}
%\renewcommand{\thesecondtypesetter}{Cian Dawson}
\renewcommand{\reportrefname}{References Cited}

\makeatletter
\newcommand{\customlabel}[2]{%
   \protected@write \@auxout {}{\string \newlabel {#1}{{#2}{\thepage}{#2}{#1}{}} }%
   \hypertarget{#1}{}
}

\newcommand{\customcolophon}{
Publishing support provided by the U.S. Geological Survey \\
\theauthors
\newline \newline
For information concerning this publication, please contact:
\newline \newline
Office of Groundwater \\ U.S. Geological Survey \\ Mail Stop 411 \\ 12201 Sunrise Valley Drive \\ Reston, VA 20192 \\ (703) 648--5001 \\
https://water.usgs.gov/ogw/
}

\renewcommand{\reportrefname}{References Cited}
\newcommand{\inreferences}{%
\renewcommand{\theequation}{R--\arabic{equation}}%
\setcounter{equation}{0}%
\renewcommand{\thefigure}{R--\arabic{figure}}%
\setcounter{figure}{0}%
\renewcommand{\thetable}{R--\arabic{table}}%
\setcounter{table}{0}%
\renewcommand{\thepage}{R--\arabic{page}}%
\setcounter{page}{1}%
}

\newcounter{appendixno}
\setcounter{appendixno}{0}
\newcommand{\inappendix}{%
\addtocounter{appendixno}{1}%
\renewcommand{\theequation}{\Alph{appendixno}--\arabic{equation}}%
\setcounter{equation}{0}%
\renewcommand{\thefigure}{\Alph{appendixno}--\arabic{figure}}%
\setcounter{figure}{0}%
\renewcommand{\thetable}{\Alph{appendixno}--\arabic{table}}%
\setcounter{table}{0}%
\renewcommand{\thepage}{\Alph{appendixno}--\arabic{page}}%
\setcounter{page}{1}%
}

\nobibliography*

\begin{document}

%\makefrontcover
\ifdef{\makefrontcoveralt}{\makefrontcoveralt}{\makefrontcover}

%\makefrontmatter
%\maketoc
\ifdef{\makefrontmatterabv}{\makefrontmatterabv}{\makefrontmatter}

\onecolumn
\pagestyle{body}
\RaggedRight
\hbadness=10000
\pagestyle{body}
\setlength{\parindent}{1.5pc}

% -------------------------------------------------
\section{Introduction}
This document describes MODFLOW~6 Version \modflowversion.  This distribution is packaged for personal computers using the Microsoft Windows 7 and 10 operating systems, although it may run on other versions of Windows.  The executable file was compiled for 64-bit Windows operating systems and should run on most personal computers.

Version numbers for MODFLOW~6 will follow a major.minor.revision format.  The major number will be increased when there are substantial new changes that may break backward compatibility.  The minor number will be increased when important, but relatively minor new functionality is added.  The revision number will be added when errors are corrected in either the program or input files.

MODFLOW~6 is tested with a large number of example problems, and new capabilities are thoroughly tested as they are integrated into the program.  Additional testing can sometimes reveal errors in the program.  These errors are fixed as soon as possible and made available in a subsequent release.  Every effort is made to maintain backward compatibility of the format for MODFLOW~6 input files; however, this goal is not always possible, especially for newer packages and models.  Changes to the program to add new functionality, correct errors, or alter the format for an input file are summarized in this release notes document.

% -------------------------------------------------
\section{History}
This section describes changes introduced into MODFLOW~6 for the current release.  Changes introduced in previous releases are in Appendix~\ref{app:A}. These changes may substantially affect users.

\begin{itemize}
	\item Version mf6.3.0--Month, Day, Year
	
	\underline{NEW FUNCTIONALITY}
	\begin{itemize}
	        \item The option already existed to provide binary budget and head file information from a GWF simulation for only the first time step of a given stress period, in which case that information will be used for all time steps in that stress period in a GWT simulation that reads from those files. The behavior of this option has been extended such that if the binary budget and head file information provided for the final stress period of the GWF simulation is for only one time step, that information will be used for any subsequent time steps and stress periods in the GWT simulation. This extended behavior includes as a special case the use of binary budget and head file information from only one time step in only one stress period (for example, a single steady-state GWF stress period) for all time steps in all stress periods in a GWT simulation.
	        \item Added new file-based input capability for the GWT Source and Sink Mixing (SSM) Package.  The SSM Package previously required that all source and sink concentrations be provided as auxiliary variables for corresponding GWF stress packages.  The SSM Package now supports an optional new FILEINPUT block, which can be provided with package names and file names.  Files referenced in the FILEINPUT block can be used to provide time-varying source and sink concentrations.  A description of this new Stress Package Concentration (SPC) Input file is described in the input and output guide under a new section titled ``File Input for Boundary Concentrations.''  If used, a single SSMI file can be provided for a corresponding GWF stress package.  Either an SPC file or the auxiliary variable approach can be used to supply concentrations for a single GWF stress package, but not both.
	        \item Added BUDGETCSV option to GWF and GWT model output control.  If activated, this option will cause a comma-separated value (CSV) file of the model budget terms to be written to a user-specified output file.
	\end{itemize}
	
	\underline{EXAMPLES}
	\begin{itemize}
	        \item --
	\end{itemize}

	\textbf{\underline{BUG FIXES AND OTHER CHANGES TO EXISTING FUNCTIONALITY}} \\
	\underline{BASIC FUNCTIONALITY}
	\begin{itemize}
	        \item Fixed a bug that caused the last binary budget and head file information provided by a GWF simulation in a given stress period to be used for all subsequent GWT simulation time steps in that stress period, even if binary budget and head file information was provided for more than one time step in that stress period. In that situation, the GWF time steps must match the GWT time steps one-for-one.
	        \item Boundary packages, such as WEL, DRN and GHB, for example, read lists of data using a general list reader.  For text input, the list of data would not be read correctly if it was longer than 300 characters wide.  Most lists would normally be less than 300 characters unless a large number of auxiliary variables were specified.  In this case, information beyond 300 characters would not be read.  The list reader was modified to use an unlimited character length so that any number of auxiliary variables can be specified.
	        \item The Observation (OBS) functionality can optionally write simulated values to a comma-separated value (CSV) output file.  The OBS input file contains a DIGITS option, which controls the number of digits written to the CSV output file.  In some cases the ``E'' character was not written, making it difficult to read the CSV output file with other programs.  New functionality was programmed to write observations using the maximum number of digits stored internally by the program using the G0 Fortran specifier.  The default value for DIGITS was five, but this has been changed to this maximum number of digits.  This maximum number of digits can also be activated by specifying a zero for DIGITS.  For most applications, observations should be written with the default number of digits so that no precision is lost in the output.
	\end{itemize}

	\underline{STRESS PACKAGES}
	\begin{itemize}
	        \item Fixed a bug in the Recharge (RCH) and Evapotranspiration (EVT) Packages that would occur with array-based input (READASARRAYS) combined with the Time-Array Series (TAS) functionality.  Because the TAS functionality only works for DIS and DISU models, this fix does not have any effect on models that use DISU discretization.  The bug would occur when one or more cells in the upper layer were removed using the IDOMAIN capability.  In this special case, the time-array series values did not carry over to the correct locations in the RCH and EVT arrays.  This error would be difficult to identify for complex models, because the model would run to completion without any errors.  The RCH and EVT Packages were modified to maintain direct correspondence between the \texttt{nodelist} and \texttt{bound} arrays with the arrays provided to the TAS utility.  A small and intended consequence of this fix is that the ID2 value written to the binary budget file for array-based RCH and EVT Packages will correspond to the consecutive cell number in the top layer.  
	        \item Recharge and evapotranspiration flows that are written to the GWF Model binary budget file are marked with the text headers ``RCH'' and ``EVT'', respectively.  In order to support the array-based input for SSM concentrations, these text headers are marked as ``RCHA'' and ``EVTA'', respectively, if the READASARRAYS option is specified for the package.  This change will have no effect on simulation results; however, post processing capabilities may need to be adjusted to account for this minor renaming convention.
	        \item When the PRINT\_FLOWS option was used with the Source and Sink Mixing (SSM) Package, the cell ID numbers written to the listing file were incorrect.  The SSM Package was fixed to output the correct cell ID.
	\end{itemize}

	\underline{ADVANCED STRESS PACKAGES}
	\begin{itemize}
	        \item The Streamflow Routing (SFR) Package would die with a floating point error when calculating the stream depth as a function of flow rate, if the flow rate was slightly negative.  Added a conditional check to ensure that the stream depth is calculated as zero if the calculated flow rate is zero or less.
	\end{itemize}

	\underline{SOLUTION}
	\begin{itemize}
	        \item xxx  
	        \item xxx  
	\end{itemize}

\end{itemize}


% -------------------------------------------------
\section{Known Issues}
This section describes known issues with this release of MODFLOW~6.  

\begin{enumerate}

\item
The AUXMULTNAME option can be used to scale input values, such as riverbed conductance, using values in an auxiliary column.  When this AUXMULTNAME option is used, the multiplier value in the AUXMULTNAME column should not be represented with a time series unless the value to scale is also represented with a time series.  

\item
The capability to use Unsaturated Zone Flow (UZF) routing beneath lakes and streams has not been implemented.

\item
Multi-point cross-section geometries have not been implemented in the Streamflow Routing (SFR) package.

\item
For the Groundwater Transport (GWT) Model, the decay and sorption processes do not apply to the LKT, SFT, MWT and UZT Packages.

\item
The GWT Model does not yet work with the CSUB Package of the GWF Model.  

\end{enumerate}

In addition to the issues shown here, a comprehensive and up-to-date list is available under the issues tab at \url{https://github.com/MODFLOW-USGS/modflow6}.


% -------------------------------------------------
\section{Distribution File}
The following distribution file is for use on personal computers: \texttt{\modflowversion.zip}.  The distribution file is a compressed zip file. The following directory structure is incorporated in the zip file:

% folder structured created by python script
\input{folder_struct.tex}

It is recommended that no user files are kept in the \modflowversion~directory structure.  If you do plan to put your own files in the \modflowversion~directory structure, do so only by creating additional subdirectories.

% -------------------------------------------------
\section{Installation and Execution}
There is no installation of MODFLOW~6 other than the requirement that \texttt{\modflowversion.zip} must be unzipped into a location where it can be accessed.  

To make the executable versions of MODFLOW~6 accessible from any directory, the directory containing the executables should be included in the PATH environment variable.  Also, if a prior release of MODFLOW~6 is installed on your system, the directory containing the executables for the prior release should be removed from the PATH environment variable.

As an alternative, the executable file, ``\texttt{mf6.exe}'', in the \modflowversion{}/bin directory can be copied into a directory already included in the PATH environment variable.

To run MODFLOW~6, simply type \texttt{mf6} in a terminal window.  The current working directory must be set to a location where the model input files are located.  Upon execution, MODFLOW~6 will immediately look for file with the name \texttt{mfsim.nam} in the current working directory, and will terminate with an error if it does not find this file.

% -------------------------------------------------
\section{Compiling MODFLOW~6}
MODFLOW~6 has been compiled using Intel Visual Fortran and gfortran on the Windows and Mac/OS operating systems.  Because the program uses relatively new Fortran extensions, newer versions of the compilers may be required for successful compilation.  For example, to use gfortran to compile MODFLOW~6, gfortran version 4.9 or newer must be used.  If you have gfortran installed on your computer, you can tell which version it is by entering ``\verb|gfortran --version|'' at a terminal window.

This distribution contains the Microsoft Visual Studio solution and project files for compiling MODFLOW~6 on Windows using the Intel Fortran Compiler.  The files have been used successfully with Microsoft Visual Studio Community 2019 and Intel(R) Visual Fortran Compiler 2020.0.166.  To compile MODFLOW~6, open the mf6.sln file in the msvs folder and click Build >  Build Solution.  A separate Visual Studio solution file is also included for building the BMI dynamically linked library version of MODFLOW~6.

This distribution also comes with a makefile for compiling MODFLOW~6 with \texttt{gfortran}.  The makefile is contained in the \texttt{make} folder.

For those familiar with Python, the pymake package can also be used to compile MODFLOW~6.  Additional information on the Python pymake utility can be found at: \url{https://github.com/modflowpy/pymake}.  

% -------------------------------------------------
\section{System Requirements}
MODFLOW~6 is written in Fortran.  It uses features from the 95, 2003, and 2008 language.  The code has been used on UNIX-based computers and personal computers running various forms of the Microsoft Windows operating system.

% -------------------------------------------------
\section{Testing}
The examples distributed with MODFLOW~6 can be run by navigating to the examples folder and executing the ``\texttt{run.bat}'' batch files within each example folder.  Alternatively, there is a ``\texttt{runall.bat}'' batch file under the examples folder that will run all of the test problems.

% -------------------------------------------------
\section{MODFLOW~6 Documentation}
Details on the numerical methods and the underlying theory for MODFLOW~6 are described in the following reports and papers:

\begin{itemize}

\item \bibentry{modflow6framework}

\item \bibentry{modflow6gwf}

\item \bibentry{modflow6xt3d}

\item \bibentry{langevin2020hydraulic}

\item \bibentry{morway2021}

\end{itemize}
 
\noindent Description of the MODFLOW~6 input and output is included in this distribution in the ``doc'' folder as mf6io.pdf.

% -------------------------------------------------
% if runtime information exists, then include the run time comparison table
\IfFileExists{./run-time-comparison.tex}{\input{./run-time-comparison.tex}}{}

% -------------------------------------------------
\section{Disclaimer and Notices}

This software has been approved for release by the U.S. Geological Survey (USGS). Although the software has been subjected to rigorous review, the USGS reserves the right to update the software as needed pursuant to further analysis and review. No warranty, expressed or implied, is made by the USGS or the U.S. Government as to the functionality of the software and related material nor shall the fact of release constitute any such warranty. Furthermore, the software is released on condition that neither the USGS nor the U.S. Government shall be held liable for any damages resulting from its authorized or unauthorized use. Also refer to the USGS Water Resources Software User Rights Notice for complete use, copyright, and distribution information.

Notices related to this software are as follows:
\begin{itemize}
\item This software is a product of the U.S. Geological Survey, which is part of the U.S. Government.

\item This software is freely distributed. There is no fee to download and (or) use this software.

\item Users do not need a license or permission from the USGS to use this software. Users can download and install as many copies of the software as they need.

\item As a work of the United States Government, this USGS product is in the public domain within the United States. You can copy, modify, distribute, and perform the work, even for commercial purposes, all without asking permission. Additionally, USGS waives copyright and related rights in the work worldwide through CC0 1.0 Universal Public Domain Dedication (\url{https://creativecommons.org/publicdomain/zero/1.0/}).
\end{itemize}


\newpage
\ifx\usgsdirector\undefined
\addcontentsline{toc}{section}{\hspace{1.5em}\bibname}
\else
\inreferences
\REFSECTION
\fi
\input{bibliography.tex}


\newpage
\inappendix
\SECTION{Appendix A. Changes Introduced in Previous Versions}
\customlabel{app:A}{A}
\input{./appendixA.tex}


\justifying
\vspace*{\fill}
\clearpage
\pagestyle{backofreport}
\makebackcover
\end{document}
